"use strict";const Z=require("@codemirror/state"),t=require("@lezer/highlight"),m=require("markedit-api"),I=require("@codemirror/view"),k=require("@codemirror/language"),y=(o,n={})=>o??n,tt=y(m.MarkEdit.userSettings),w=V("extension.markeditTheming"),et=b(!1)?y(w.lightTheme):void 0,ot=b(!0)?y(w.darkTheme):void 0;function V(o){return o===void 0?{}:y(tt[o])}function D(o){return o.enabledMode??"both"}function b(o,n=D(w)){return["both",o?"dark":"light"].includes(n)}function rt(o,n,c){const r=at({lhs:c,rhs:o?ot:et});return{extensions:[...o?$(r,{dark:!0}):$(r),n].filter(e=>e!==void 0),colors:r}}function $(o,n){const c={},r=[],a=o.editor,e=o.highlight;a?.textColor&&(c["&"]??={},c["&"].color=a?.textColor,c[".cm-activeLineGutter"]={backgroundColor:a?.textColor}),a?.backgroundColor&&(c["&"]??={},c["&"].backgroundColor=a?.backgroundColor),a?.activeLineBackground&&(c[".cm-activeLine"]={backgroundColor:a?.activeLineBackground}),a?.caretColor&&(c[".cm-content"]={caretColor:a?.caretColor},c[".cm-cursor, .cm-dropCursor"]={borderLeftColor:a?.caretColor}),a?.selectionBackground&&(c["&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection"]={backgroundColor:a?.selectionBackground}),a?.matchingBracketBackground&&(c["&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket"]={backgroundColor:a?.matchingBracketBackground}),a?.gutterText&&(c[".cm-gutters"]??={},c[".cm-gutters"].color=a?.gutterText),a?.gutterBackground&&(c[".cm-gutters"]??={},c[".cm-gutters"].backgroundColor=a?.gutterBackground,c[".cm-gutters"].border="none"),a?.foldPlaceholderText&&(c[".cm-foldPlaceholder"]??={},c[".cm-foldPlaceholder"].color=a?.foldPlaceholderText),a?.foldPlaceholderBackground&&(c[".cm-foldPlaceholder"]??={},c[".cm-foldPlaceholder"].backgroundColor=a?.foldPlaceholderBackground,c[".cm-foldPlaceholder"].border="none"),a?.searchMatchBackground&&(c[".cm-searchMatch"]={backgroundColor:a?.searchMatchBackground}),a?.selectionMatchBackground&&(c[".cm-selectionMatch"]={backgroundColor:a?.selectionMatchBackground}),e?.heading&&r.push({tag:t.tags.heading,color:e?.heading}),e?.bold&&r.push({tag:t.tags.strong,color:e?.bold}),e?.italic&&r.push({tag:t.tags.emphasis,color:e?.italic}),e?.strikethrough&&r.push({tag:t.tags.strikethrough,color:e?.strikethrough}),e?.quote&&r.push({tag:t.tags.quote,color:e?.quote}),e?.link&&r.push({tag:[t.tags.url,t.tags.link],color:e?.link}),e?.separator&&r.push({tag:[t.tags.definition(t.tags.name),t.tags.separator,t.tags.contentSeparator],color:e?.separator}),e?.comment&&r.push({tag:t.tags.comment,color:e?.comment}),e?.meta&&r.push({tag:t.tags.meta,color:e?.meta}),e?.keyword&&r.push({tag:t.tags.keyword,color:e?.keyword}),e?.atom&&r.push({tag:[t.tags.atom,t.tags.bool],color:e?.atom}),e?.literal&&r.push({tag:[t.tags.literal,t.tags.inserted],color:e?.literal}),e?.string&&r.push({tag:[t.tags.string,t.tags.deleted],color:e?.string}),e?.special&&r.push({tag:[t.tags.regexp,t.tags.escape,t.tags.special(t.tags.string)],color:e?.special}),e?.variable&&r.push({tag:t.tags.definition(t.tags.variableName),color:e?.variable}),e?.local&&r.push({tag:t.tags.local(t.tags.variableName),color:e?.local}),e?.type&&r.push({tag:[t.tags.typeName,t.tags.namespace],color:e?.type}),e?.class&&r.push({tag:t.tags.className,color:e?.class}),e?.macro&&r.push({tag:[t.tags.special(t.tags.variableName),t.tags.macroName],color:e?.macro}),e?.property&&r.push({tag:t.tags.definition(t.tags.propertyName),color:e?.property}),e?.label&&r.push({tag:t.tags.labelName,color:e?.label}),e?.operator&&r.push({tag:[t.tags.operator,t.tags.operatorKeyword],color:e?.operator}),e?.constant&&r.push({tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:e?.constant}),e?.instruction&&r.push({tag:t.tags.processingInstruction,color:e?.instruction}),e?.invalid&&r.push({tag:t.tags.invalid,color:e?.invalid});const g=[];return Object.keys(c).length>0&&g.push(I.EditorView.theme(c,n)),r.length>0&&g.push(k.syntaxHighlighting(k.HighlightStyle.define(r))),g}function at(o){return{editor:{...o.lhs?.editor,...o.rhs?.editor},highlight:{...o.lhs?.highlight,...o.rhs?.highlight},subtleEmphasis:o.rhs?.subtleEmphasis??o.lhs?.subtleEmphasis}}const s={selectionBackground:".cm-selectionBackground",lineGutter:".cm-lineNumbers > .cm-activeLineGutter",foldGutter:".cm-foldGutter, .cm-foldPlaceholder",visibleSpace:".cm-visibleSpace, .cm-visibleSpace::before, .cm-visibleLineBreak, .cm-visibleLineBreak::before",matchingBracket:".cm-matchingBracket",activeIndicator:".cm-md-activeIndicator",emphasisElement:".cm-md-bold:not(.tok-meta), .cm-md-italic:not(.tok-meta), .cm-md-quote:not(.cm-md-quoteMark)",accentColor:".cm-md-header:not(.tok-meta):not(.cm-md-quote), .cm-md-codeInfo",syntaxMarker:".cm-md-header.tok-meta:not(.cm-md-quote), .cm-md-codeMark, .cm-md-linkMark, .cm-md-listMark, .cm-md-quoteMark"},ct=`
.cm-activeLineGutter { background: inherit !important }
.cm-searchMatch.cm-searchMatch-selected { outline: inherit !important }
${s.lineGutter} {}
${s.foldGutter} {}
${s.visibleSpace} {}
${s.matchingBracket} {}
${s.activeIndicator} {}
${s.emphasisElement} {}
${s.accentColor} {}
${s.syntaxMarker} {}
`,A=window,nt=A.__extractStyleRules__??(o=>o.value?.rules),st=A.__extractHighlightSpecs__??(o=>o.value?.specs);function it(o){const n=document.createElement("style");return n.textContent=o,document.head.appendChild(n),n}function lt(o){if(o.length===0)return[{},[]];const n=T(o);return[Object.fromEntries(n.flatMap(r=>{const a=nt(r)?.join(`
`)??"";return Object.entries(dt(a))})),n.flatMap(r=>st(r)??[])]}function q(o,n){return o.find(c=>!!(c.tag.toString().includes(n.toString())&&c.color!==void 0))?.color}function B(o,n,c){for(const[r,a]of Object.entries(o))if(r.includes(n)&&(c===void 0||!r.includes(c))){const e=a.background??a.backgroundColor;if(e!==void 0)return e}}function gt(o){const n=o.match(/rgba?\((\d+), (\d+), (\d+)(?:, ([\d.]+))?\)/);if(n===null)return;const[c,r,a]=n.slice(1,4).map(Number);return`rgba(${c}, ${r}, ${a}, 0.6)`}function K(o){const n=a=>a!==null&&typeof a=="object";if(!n(o))return!0;const c=Object.entries(o),r=a=>a!=null;for(const[,a]of c)if(n(a)){if(!K(a))return!1}else if(r(a))return!1;return!0}function T(o){return Array.isArray(o)?o.flatMap(T):"extension"in o?T(o.extension):[o]}function dt(o){const n={},c=new CSSStyleSheet;c.replaceSync(o);for(const r of c.cssRules){const{style:a,selectorText:e}=r,{background:g,backgroundColor:u}=a;n[e]={},g.length>0&&(n[e].background=g),u.length>0&&(n[e].backgroundColor=u)}return n}function ut(o){const n=o.options?.settingsKey,c=D(V(n));o.light!==void 0&&b(!1,c)&&(i().customThemes.light=o.light),o.dark!==void 0&&b(!0,c)&&(i().customThemes.dark=o.dark),typeof m.MarkEdit.editorView=="object"&&M(m.MarkEdit.editorView)}const f=window,i=()=>f.__markeditTheming__,U=matchMedia("(prefers-color-scheme: dark)");typeof i()!="object"&&mt();function mt(){f.__markeditTheming__={styleSheet:it(ct),configurator:new Z.Compartment,customThemes:{},lightOriginalRules:{},darkOriginalRules:{}},m.MarkEdit.addExtension(i().configurator.of([])),m.MarkEdit.onEditorReady(n=>M(n));const o=()=>setTimeout(()=>M(m.MarkEdit.editorView),15);U.addEventListener("change",o),i().mainThemeName=f.config.theme,Object.defineProperty(f.config,"theme",{get(){return i().mainThemeName},set(n){i().mainThemeName=n,o()}})}function M(o){const n=U.matches,c=n?i().customThemes.dark:i().customThemes.light,{extensions:r,colors:a}=rt(n,c?.extension,c?.colors);o.dispatch({effects:i().configurator.reconfigure(r)});const[e,g]=lt(r),u=r.length===0&&K(a);i().styleSheet.disabled=u,ht(o,n,u,e,g,a)}function ht(o,n,c,r,a,e){const g=B(r,".cm-activeLine",".cm-activeLineGutter"),u=B(r,s.selectionBackground),W=B(r,s.matchingBracket),E=getComputedStyle(o.contentDOM).color,N=e.editor?.visibleSpaceColor??gt(E),P=q(a,t.tags.heading),F=q(a,t.tags.processingInstruction),z=[[s.activeIndicator,g,"background"],[s.matchingBracket,W,"background"],[s.lineGutter,E,"color"],[s.foldGutter,N,"color"],[s.visibleSpace,N,"color"],[s.accentColor,P,"color"],[s.syntaxMarker,F,"color"]],J=Array.from(document.querySelectorAll("style")),h=n?i().darkOriginalRules:i().lightOriginalRules;for(const Q of J){const C=Q.sheet?.cssRules;if(C!==void 0)for(let v=0;v<C.length;++v){const l=C[v],d=l.selectorText??"";d.includes(".cm-focused")&&d.includes(s.selectionBackground)&&(h.selectionBackground??=l.cssText,c?l.cssText=h.selectionBackground:u!==void 0&&l.style.setProperty("background",u,"important")),P!==void 0&&(d===".cm-md-header"||d===".cm-md-header:not(.cm-md-quote)")&&(h.markdownHeader??=l.cssText,c?l.cssText=h.markdownHeader:l.style.removeProperty("color"));for(const[X,L,_]of z)if(d===X)if(L===void 0)l.style.removeProperty(_);else{const Y=[s.accentColor,s.syntaxMarker].includes(d)?void 0:"important";l.style.setProperty(_,L,Y),(d===s.matchingBracket||d===s.activeIndicator)&&l.style.setProperty("box-shadow","unset","important")}d===s.emphasisElement&&(e.subtleEmphasis??!0?l.style.setProperty("color","inherit","important"):l.style.removeProperty("color"))}}}const ft="#e5c07b",O="#e06c75",pt="#56b6c2",kt="#ffffff",p="#abb2bf",S="#7d8799",bt="#61afef",yt="#98c379",j="#d19a66",Ct="#c678dd",vt="#21252b",G="#2c313a",R="#282c34",x="#353a42",Bt="#3E4451",H="#528bff",xt=I.EditorView.theme({"&":{color:p,backgroundColor:R},".cm-content":{caretColor:H},".cm-cursor, .cm-dropCursor":{borderLeftColor:H},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:Bt},".cm-panels":{backgroundColor:vt,color:p},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:R,color:S,border:"none"},".cm-activeLineGutter":{backgroundColor:G},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:x},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:x,borderBottomColor:x},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:G,color:p}}},{dark:!0}),Tt=k.HighlightStyle.define([{tag:t.tags.keyword,color:Ct},{tag:[t.tags.name,t.tags.deleted,t.tags.character,t.tags.propertyName,t.tags.macroName],color:O},{tag:[t.tags.function(t.tags.variableName),t.tags.labelName],color:bt},{tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:j},{tag:[t.tags.definition(t.tags.name),t.tags.separator],color:p},{tag:[t.tags.typeName,t.tags.className,t.tags.number,t.tags.changed,t.tags.annotation,t.tags.modifier,t.tags.self,t.tags.namespace],color:ft},{tag:[t.tags.operator,t.tags.operatorKeyword,t.tags.url,t.tags.escape,t.tags.regexp,t.tags.link,t.tags.special(t.tags.string)],color:pt},{tag:[t.tags.meta,t.tags.comment],color:S},{tag:t.tags.strong,fontWeight:"bold"},{tag:t.tags.emphasis,fontStyle:"italic"},{tag:t.tags.strikethrough,textDecoration:"line-through"},{tag:t.tags.link,color:S,textDecoration:"underline"},{tag:t.tags.heading,fontWeight:"bold",color:O},{tag:[t.tags.atom,t.tags.bool,t.tags.special(t.tags.variableName)],color:j},{tag:[t.tags.processingInstruction,t.tags.string,t.tags.inserted],color:yt},{tag:t.tags.invalid,color:kt}]),Mt=[xt,k.syntaxHighlighting(Tt)];ut({dark:{extension:Mt}});
