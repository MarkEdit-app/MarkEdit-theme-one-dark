"use strict";const at=require("@codemirror/state"),t=require("@lezer/highlight"),f=require("markedit-api"),D=require("@codemirror/view"),v=require("@codemirror/language"),x=(o,n={})=>o??n,ct=x(f.MarkEdit.userSettings),L=F("extension.markeditTheming"),nt=y(!1)?x(L.lightTheme):void 0,st=y(!0)?x(L.darkTheme):void 0;function F(o){return o===void 0?{}:x(ct[o])}function A(o){return o.enabledMode??"both"}function y(o,n=A(L)){return["both",o?"dark":"light"].includes(n)}function it(o,n,c){const a=lt({lhs:c,rhs:o?st:nt});return{extensions:[...o?j(a,{dark:!0}):j(a),n].filter(e=>e!==void 0),colors:a}}function j(o,n){const c={},a=[],r=o.editor,e=o.highlight;r?.textColor&&(c["&"]??={},c["&"].color=r?.textColor,c[".cm-activeLineGutter"]={backgroundColor:r?.textColor}),r?.backgroundColor&&(c["&"]??={},c["&"].backgroundColor=r?.backgroundColor),r?.activeLineBackground&&(c[".cm-activeLine"]={backgroundColor:r?.activeLineBackground}),r?.caretColor&&(c[".cm-content"]={caretColor:r?.caretColor},c[".cm-cursor, .cm-dropCursor"]={borderLeftColor:r?.caretColor}),r?.selectionBackground&&(c["&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection"]={backgroundColor:r?.selectionBackground}),r?.matchingBracketBackground&&(c["&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket"]={backgroundColor:r?.matchingBracketBackground}),r?.gutterText&&(c[".cm-gutters"]??={},c[".cm-gutters"].color=r?.gutterText),r?.gutterBackground&&(c[".cm-gutters"]??={},c[".cm-gutters"].backgroundColor=r?.gutterBackground,c[".cm-gutters"].border="none"),r?.foldPlaceholderText&&(c[".cm-foldPlaceholder"]??={},c[".cm-foldPlaceholder"].color=r?.foldPlaceholderText),r?.foldPlaceholderBackground&&(c[".cm-foldPlaceholder"]??={},c[".cm-foldPlaceholder"].backgroundColor=r?.foldPlaceholderBackground,c[".cm-foldPlaceholder"].border="none"),r?.searchMatchBackground&&(c[".cm-searchMatch"]={backgroundColor:r?.searchMatchBackground}),r?.selectionMatchBackground&&(c[".cm-selectionMatch"]={backgroundColor:r?.selectionMatchBackground}),e?.heading&&a.push({tag:t.tags.heading,color:e?.heading}),e?.bold&&a.push({tag:t.tags.strong,color:e?.bold}),e?.italic&&a.push({tag:t.tags.emphasis,color:e?.italic}),e?.strikethrough&&a.push({tag:t.tags.strikethrough,color:e?.strikethrough}),e?.quote&&a.push({tag:t.tags.quote,color:e?.quote}),e?.link&&a.push({tag:[t.tags.url,t.tags.link],color:e?.link}),e?.divider&&a.push({tag:t.tags.contentSeparator,color:e?.divider}),e?.comment&&a.push({tag:t.tags.comment,color:e?.comment}),e?.meta&&a.push({tag:t.tags.meta,color:e?.meta}),e?.keyword&&a.push({tag:t.tags.keyword,color:e?.keyword}),e?.atom&&a.push({tag:[t.tags.atom,t.tags.bool],color:e?.atom}),e?.literal&&a.push({tag:[t.tags.literal,t.tags.inserted],color:e?.literal}),e?.string&&a.push({tag:[t.tags.string,t.tags.deleted],color:e?.string}),e?.special&&a.push({tag:[t.tags.regexp,t.tags.escape,t.tags.special(t.tags.string)],color:e?.special}),e?.variable&&a.push({tag:t.tags.definition(t.tags.variableName),color:e?.variable}),e?.local&&a.push({tag:t.tags.local(t.tags.variableName),color:e?.local}),e?.type&&a.push({tag:[t.tags.typeName,t.tags.namespace],color:e?.type}),e?.class&&a.push({tag:t.tags.className,color:e?.class}),e?.macro&&a.push({tag:[t.tags.special(t.tags.variableName),t.tags.macroName],color:e?.macro}),e?.property&&a.push({tag:t.tags.definition(t.tags.propertyName),color:e?.property}),e?.label&&a.push({tag:t.tags.labelName,color:e?.label}),e?.operator&&a.push({tag:[t.tags.operator,t.tags.operatorKeyword],color:e?.operator}),e?.constant&&a.push({tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:e?.constant}),e?.instruction&&a.push({tag:[t.tags.separator,t.tags.processingInstruction,t.tags.definition(t.tags.name)],color:e?.instruction}),e?.invalid&&a.push({tag:t.tags.invalid,color:e?.invalid});const l=[];return Object.keys(c).length>0&&l.push(D.EditorView.theme(c,n)),a.length>0&&l.push(v.syntaxHighlighting(v.HighlightStyle.define(a))),l}function lt(o){return{editor:{...o.lhs?.editor,...o.rhs?.editor},highlight:{...o.lhs?.highlight,...o.rhs?.highlight},allowsFallback:o.rhs?.allowsFallback??o.lhs?.allowsFallback}}const s={selectionBackground:".cm-selectionBackground",lineGutter:".cm-lineNumbers > .cm-activeLineGutter",foldGutter:".cm-foldGutter, .cm-foldPlaceholder",visibleSpace:".cm-visibleSpace, .cm-visibleSpace::before, .cm-visibleLineBreak, .cm-visibleLineBreak::before",matchingBracket:".cm-matchingBracket",activeIndicator:".cm-md-activeIndicator",accentColor:".cm-md-header:not(.tok-meta):not(.cm-md-quote), .cm-md-codeInfo",syntaxMarker:".cm-md-header.tok-meta:not(.cm-md-quote), .cm-md-codeMark, .cm-md-linkMark, .cm-md-listMark, .cm-md-quoteMark, .cm-md-bold.tok-meta, .cm-md-italic.tok-meta, .cm-md-strikethrough.tok-meta",boldText:".cm-md-bold:not(.tok-meta)",italicText:".cm-md-italic:not(.tok-meta)",quoteText:".cm-md-quote:not(.cm-md-quoteMark)",dividerColor:".cm-md-horizontalRule"},gt=`
.cm-activeLineGutter { background: inherit !important }
.cm-searchMatch.cm-searchMatch-selected { outline: inherit !important }
${s.lineGutter} {}
${s.foldGutter} {}
${s.visibleSpace} {}
${s.matchingBracket} {}
${s.activeIndicator} {}
${s.accentColor} {}
${s.syntaxMarker} {}
${s.boldText} {}
${s.italicText} {}
${s.quoteText} {}
${s.dividerColor} {}
`,K=window,dt=K.__extractStyleRules__??(o=>o.value?.rules),ut=K.__extractHighlightSpecs__??(o=>o.value?.specs);function mt(o){const n=document.createElement("style");return n.textContent=o,document.head.appendChild(n),n}function ht(o){if(o.length===0)return[{},[]];const n=q(o);return[Object.fromEntries(n.flatMap(a=>{const r=dt(a)?.join(`
`)??"";return Object.entries(kt(r))})),n.flatMap(a=>ut(a)??[])]}function h(o,n,c){return o.find(a=>!!(a.tag.toString().includes(n.toString())&&a.color!==void 0))?.color??c}function w(o,n,c){for(const[a,r]of Object.entries(o))if(a.includes(n)&&(c===void 0||!a.includes(c))){const e=r.background??r.backgroundColor;if(e!==void 0)return e}}function ft(o){const n=o.match(/rgba?\((\d+), (\d+), (\d+)(?:, ([\d.]+))?\)/);if(n===null)return;const[c,a,r]=n.slice(1,4).map(Number);return`rgba(${c}, ${a}, ${r}, 0.6)`}function U(o){const n=r=>r!==null&&typeof r=="object";if(!n(o))return!0;const c=Object.entries(o),a=r=>r!=null;for(const[,r]of c)if(n(r)){if(!U(r))return!1}else if(a(r))return!1;return!0}function q(o){return Array.isArray(o)?o.flatMap(q):"extension"in o?q(o.extension):[o]}function kt(o){const n={},c=new CSSStyleSheet;c.replaceSync(o);for(const a of c.cssRules){const{style:r,selectorText:e}=a,{background:l,backgroundColor:d}=r;n[e]={},l.length>0&&(n[e].background=l),d.length>0&&(n[e].backgroundColor=d)}return n}function pt(o){const n=o.options?.settingsKey,c=A(F(n));o.light!==void 0&&y(!1,c)&&(i().customThemes.light=o.light),o.dark!==void 0&&y(!0,c)&&(i().customThemes.dark=o.dark),typeof f.MarkEdit.editorView=="object"&&N(f.MarkEdit.editorView)}const b=window,i=()=>b.__markeditTheming__,W=matchMedia("(prefers-color-scheme: dark)");typeof i()!="object"&&bt();function bt(){b.__markeditTheming__={styleSheet:mt(gt),configurator:new at.Compartment,customThemes:{},lightOriginalRules:{},darkOriginalRules:{}},f.MarkEdit.addExtension(i().configurator.of([])),f.MarkEdit.onEditorReady(n=>N(n));const o=()=>setTimeout(()=>N(f.MarkEdit.editorView),15);W.addEventListener("change",o),i().mainThemeName=b.config.theme,Object.defineProperty(b.config,"theme",{get(){return i().mainThemeName},set(n){i().mainThemeName=n,o()}})}function N(o){const n=W.matches,c=n?i().customThemes.dark:i().customThemes.light,{extensions:a,colors:r}=it(n,c?.extension,c?.colors);o.dispatch({effects:i().configurator.reconfigure(a)});const[e,l]=ht(a),d=a.length===0&&U(r),k=(r.allowsFallback??!0)&&c?.extension!==void 0;i().styleSheet.disabled=d,Ct(o,n,d,e,l,r,k)}function Ct(o,n,c,a,r,e,l){const d=w(a,".cm-activeLine",".cm-activeLineGutter"),k=w(a,s.selectionBackground),z=w(a,s.matchingBracket),B=getComputedStyle(o.contentDOM).color,P=e.editor?.visibleSpaceColor??ft(B),m=l?B:void 0,E=h(r,t.tags.heading,m),J=h(r,t.tags.processingInstruction,m),Q=h(r,t.tags.strong,m),X=h(r,t.tags.emphasis,m),Y=h(r,t.tags.quote,m),Z=h(r,t.tags.contentSeparator,m),tt=[[s.activeIndicator,d,"background"],[s.matchingBracket,z,"background"],[s.lineGutter,B,"color"],[s.foldGutter,P,"color"],[s.visibleSpace,P,"color"],[s.accentColor,E,"color"],[s.syntaxMarker,J,"color"],[s.boldText,Q,"color"],[s.italicText,X,"color"],[s.quoteText,Y,"color"],[s.dividerColor,Z,"color"]],et=Array.from(document.querySelectorAll("style")),p=n?i().darkOriginalRules:i().lightOriginalRules;for(const ot of et){const T=ot.sheet?.cssRules;if(T!==void 0)for(let M=0;M<T.length;++M){const g=T[M],u=g.selectorText??"";u.includes(".cm-focused")&&u.includes(s.selectionBackground)&&(p.selectionBackground??=g.cssText,c?g.cssText=p.selectionBackground:k!==void 0&&g.style.setProperty("background",k,"important")),E!==void 0&&(u===".cm-md-header"||u===".cm-md-header:not(.cm-md-quote)")&&(p.markdownHeader??=g.cssText,c?g.cssText=p.markdownHeader:g.style.removeProperty("color"));for(const[rt,_,O]of tt)u===rt&&(_===void 0?g.style.removeProperty(O):(g.style.setProperty(O,_,"important"),(u===s.matchingBracket||u===s.activeIndicator)&&g.style.setProperty("box-shadow","unset","important")))}}}const vt="#e5c07b",G="#e06c75",yt="#56b6c2",xt="#ffffff",C="#abb2bf",$="#7d8799",Bt="#61afef",Tt="#98c379",R="#d19a66",Mt="#c678dd",wt="#21252b",H="#2c313a",I="#282c34",S="#353a42",St="#3E4451",V="#528bff",qt=D.EditorView.theme({"&":{color:C,backgroundColor:I},".cm-content":{caretColor:V},".cm-cursor, .cm-dropCursor":{borderLeftColor:V},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:St},".cm-panels":{backgroundColor:wt,color:C},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:I,color:$,border:"none"},".cm-activeLineGutter":{backgroundColor:H},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:S},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:S,borderBottomColor:S},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:H,color:C}}},{dark:!0}),Nt=v.HighlightStyle.define([{tag:t.tags.keyword,color:Mt},{tag:[t.tags.name,t.tags.deleted,t.tags.character,t.tags.propertyName,t.tags.macroName],color:G},{tag:[t.tags.function(t.tags.variableName),t.tags.labelName],color:Bt},{tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:R},{tag:[t.tags.definition(t.tags.name),t.tags.separator],color:C},{tag:[t.tags.typeName,t.tags.className,t.tags.number,t.tags.changed,t.tags.annotation,t.tags.modifier,t.tags.self,t.tags.namespace],color:vt},{tag:[t.tags.operator,t.tags.operatorKeyword,t.tags.url,t.tags.escape,t.tags.regexp,t.tags.link,t.tags.special(t.tags.string)],color:yt},{tag:[t.tags.meta,t.tags.comment],color:$},{tag:t.tags.strong,fontWeight:"bold"},{tag:t.tags.emphasis,fontStyle:"italic"},{tag:t.tags.strikethrough,textDecoration:"line-through"},{tag:t.tags.link,color:$,textDecoration:"underline"},{tag:t.tags.heading,fontWeight:"bold",color:G},{tag:[t.tags.atom,t.tags.bool,t.tags.special(t.tags.variableName)],color:R},{tag:[t.tags.processingInstruction,t.tags.string,t.tags.inserted],color:Tt},{tag:t.tags.invalid,color:xt}]),$t=[qt,v.syntaxHighlighting(Nt)];pt({dark:{extension:$t}});
